- name: "{{ item.name|default(item.command) }}"
  shell: >
    docker exec --user=$(id -u) {{ docker.0.name|default('runner') }} bash -ec
    "cd {{ workdir }}; {{ item.command }}"
  become: yes
  become_user: root
  register: shell_result
  until: shell_result|succeeded
  retries: 3
  ignore_errors: yes

- name: report error
  fail:
    msg: 'Failed to exec command'
  when: not shell_result|succeeded

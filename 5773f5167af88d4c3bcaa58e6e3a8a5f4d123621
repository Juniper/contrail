{
  "comments": [
    {
      "key": {
        "uuid": "0258ee34_4f9b6b88",
        "filename": "pkg/deploy/cluster/cluster.go",
        "patchSetId": 5
      },
      "lineNbr": 160,
      "author": {
        "id": 863
      },
      "writtenOn": "2019-12-06T10:49:16Z",
      "side": 1,
      "message": "Please avoid using `if Test` in code as this causes that production code and test code to use a different path, adds unnecessary complications to code and could be seen by someone as an antipattern. In the above case could be easily avoided just by injecting Player as dependency in production code and a Fake/Mock in test/unit test. \nExample :\nhttps://review.opencontrail.org/c/Juniper/contrail/+/55680",
      "range": {
        "startLine": 159,
        "startChar": 1,
        "endLine": 160,
        "endChar": 10
      },
      "revId": "5773f5167af88d4c3bcaa58e6e3a8a5f4d123621",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "162b5215_e69224f6",
        "filename": "pkg/deploy/cluster/cluster.go",
        "patchSetId": 5
      },
      "lineNbr": 160,
      "author": {
        "id": 850
      },
      "writtenOn": "2019-12-11T21:13:52Z",
      "side": 1,
      "message": "I know \"if Test\" is anti-pattern when we need testing and we want to use mocking/stubbing. But the injection is kind of hard for now. One test for example, in pkg/deploy/cluster/cluster_test.go, function runClusterActionTest calls function manageCluster to make mock management. Function manageCluster, in turn, works like the following:\n\n    clusterDeployer, err :\u003d NewCluster(c)\n    deployer, err :\u003d clusterDeployer.GetDeployer()\n    err \u003d deployer.Deploy()\n\nAnd if we want an ansibleDeployer, GetDeployer calls function newAnsibleDeployer, newAnsibleDeployer creates container_player. So the ideal injection point is to do something like deployer.containerClient \u003d mockClient and we are done. But containerClient is an unexported field, and mockClient needs working directory information from a deployCluster instance which is created in function new AnsibleDeployer. So in one sentence, injection in this situation(in test logic instead of code logic) requires information form the lower level and one field export status changed. Adam, do you have any sugggestion about this problem?",
      "parentUuid": "0258ee34_4f9b6b88",
      "range": {
        "startLine": 159,
        "startChar": 1,
        "endLine": 160,
        "endChar": 10
      },
      "revId": "5773f5167af88d4c3bcaa58e6e3a8a5f4d123621",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": true
    }
  ]
}
provider_config:
  bms:
    ssh_user: {%if cluster.SSHUser %}{{cluster.SSHUser}}{%else%}root{%endif%}
    ssh_pwd: {%if cluster.SSHPassword %}{{cluster.SSHPassword}}{%else%}c0ntrail123{%endif%}
    ssh_public_key: {{ cluster.SSHPublicKey }}
    ssh_private_key: {{ cluster.SSHPrivateKey }}
    ntp_server: {{ cluster.NTPServer }}
    domainsuffix: {{ cluster.DomainSuffix }}

instances:
    {% for node in nodes %}
  {{ node.Hostname }}:
    ip: {{ node.IPAddress }}
    ssh_user: {{ node.Username }}
    ssh_pwd: {{ node.Password }}
    ssh_public_key: {{ node.SSHKey}}
    provider: bms
    roles:
    {% for config_node in cluster.ContrailConfigNodes %}{% for node_ref in config_node.NodeRefs %} {%if node_ref.UUID == node.UUID %}config:{% endif %} {% endfor %} {% endfor %}
    {% for configdb_node in cluster.ContrailConfigDatabaseNodes %}{% for node_ref in configdb_node.NodeRefs %} {%if node_ref.UUID == node.UUID %}config_database:{% endif %} {% endfor %} {% endfor %}
    {% for control_node in cluster.ContrailControlNodes %}{% for node_ref in control_node.NodeRefs %} {%if node_ref.UUID == node.UUID %}control:{% endif %} {% endfor %} {% endfor %}
    {% for webui_node in cluster.ContrailWebuiNodes %}{% for node_ref in webui_node.NodeRefs %} {%if node_ref.UUID == node.UUID %}webui:{% endif %} {% endfor %} {% endfor %}
    {% for analytics_node in cluster.ContrailAnalyticsNodes %}{% for node_ref in analytics_node.NodeRefs %} {%if node_ref.UUID == node.UUID %}analytics:{% endif %} {% endfor %} {% endfor %}
    {% for analyticsdb_node in cluster.ContrailAnalyticsDatabaseNodes %}{% for node_ref in analyticsdb_node.NodeRefs %} {%if node_ref.UUID == node.UUID %}analytics_database:{% endif %} {% endfor %} {% endfor %}
    {% for vrouter_node in cluster.ContrailVrouterNodes %}{% for node_ref in vrouter_node.NodeRefs %} {%if node_ref.UUID == node.UUID %}vrouter:{% endif %} {% endfor %} {% endfor %}
    {% for k8s_master_node in cluster.KubernetesMasterNodes %}{% for node_ref in k8s_master_node.NodeRefs %} {%if node_ref.UUID == node.UUID %}k8s_master:{% endif %} {% endfor %} {% endfor %}
    {% for k8s_node in cluster.KubernetesNodes %}{% for node_ref in k8s_node.NodeRefs %} {%if node_ref.UUID == node.UUID %}k8s_node:{% endif %} {% endfor %} {% endfor %}
    {% for openstack_control_node in cluster.OpenstackControlNodes %}{% for node_ref in openstack_control_node.NodeRefs %} {%if node_ref.UUID == node.UUID %}openstack_control:{% endif %} {% endfor %} {% endfor %}
    {% for openstack_network_node in cluster.OpenstackNetworkNodes %}{% for node_ref in openstack_network_node.NodeRefs %} {%if node_ref.UUID == node.UUID %}openstack_network:{% endif %} {% endfor %} {% endfor %}
    {% for openstack_storage_node in cluster.OpenstackStorageNodes %}{% for node_ref in openstack_storage_node.NodeRefs %} {%if node_ref.UUID == node.UUID %}openstack_storage:{% endif %} {% endfor %} {% endfor %}
    {% for openstack_monitoring_node in cluster.OpenstackMonitoringNodes %}{% for node_ref in openstack_monitoring_node.NodeRefs %} {%if node_ref.UUID == node.UUID %}openstack_monitoring:{% endif %} {% endfor %} {% endfor %}
    {% for openstack_compute_node in cluster.OpenstackComputeNodes %}{% for node_ref in openstack_compute_node.NodeRefs %} {%if node_ref.UUID == node.UUID %}openstack_compute:{% endif %} {% endfor %} {% endfor %} {% endfor %}

contrail_configuration:
  CONTAINER_REGISTRY: {{ cluster.ContainerRegistry }}
  CONTRAIL_VERSION: {{ cluster.ContrailVersion }}
  CLOUD_ORCHESTRATOR: {{ cluster.Orchestrator }} 
  RABBITMQ_NODE_PORT: {{ cluster.RabbitMQPort }}
  VROUTER_GATEWAY: {{ cluster.DefaultGateway }}
  PHYSICAL_INTERFACE: {{ cluster.DefaultVrouterBondInterface }}

{% if cluster.Orchestrator == "openstack" %}
kolla_config:
  kolla_globals:
  kolla_internal_vip_address: {%if cluster.OpenstackInternalVip %}{{cluster.OpenstackInternalVip}}{%else%}{{cluster.OpenstackControlNodes.0.NodeRefs.0.IPAddress}}{%endif%}
  kolla_external_vip_address: {%if cluster.OpenstackExternalVip %}{{cluster.OpenstackExternalVip}}{%else%}{{cluster.OpenstackControlNodes.0.NodeRefs.0.IPAddress}}{%endif%}
  contrail_api_interface_address: {%if cluster.ContrailAPIEndPoint %}{{cluster.ContrailAPIEndPoint}}{%else%}{{cluster.ContrailConfigNodes.0.NodeRefs.0.IPAddress}}{%endif%}
  network_interface: {%if cluster.OpenstackNetworkInterface %}{{cluster.OpenstackNetworkInterface}}{%else%}{{cluster.OpenstackExternalVipInterface}}{%endif%}
  kolla_external_vip_interface: {%if cluster.OpenstackExternalVipInterface %}{{cluster.OpenstackExternalVipInterface}}{%else%}{{cluster.OpenstackControlNodes.0.NodeRefs.0.Interface}}{%endif%}
  enable_haproxy: {%if cluster.OpenstackHaproxy %}{{cluster.OpenstackHaproxy}}{%else%}no{%endif%}
{% endif %}

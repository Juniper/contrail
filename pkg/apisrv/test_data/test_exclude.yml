name: Query parameters test
description: Tests handling of query exclude parameters
cleanup:
- path: /project/test_project_uuid
- path: /network-ipam/test_network_ipam_uuid

test_data:
  project: &project
    fq_name:
    - default-domain
    - test-project
    uuid: test_project_uuid
    parent_type: domain
    parent_uuid: beefbeef-beef-beef-beef-beefbeef0002

  network_ipam: &network_ipam
    fq_name:
    - default-domain
    - test-project
    - test-network-ipam
    uuid: test_network_ipam_uuid
    parent_type: project
    parent_uuid: test_project_uuid

  application_policy_set_ref: &application_policy_set_ref
    to:
    - default-domain
    - test-project
    - default-application-policy-set

clients:
  default:
    id: alice
    password: alice_password
    insecure: true
    scope:
      project:
        name: admin

workflow:

- name: create project
  request:
    path: /projects
    method: POST
    expected: [200]
    data:
      project: *project
  expect:
    project:
      <<: *project
      network_ipams: null

- name: create network ipam
  request:
    path: /network-ipams
    method: POST
    expected: [200]
    data:
      network-ipam: *network_ipam
  expect:
    network-ipam: *network_ipam

- name: get project with childred and back refs
  request:
    path: /project/test_project_uuid
    method: GET
    expected: [200]
  expect:
    project:
      <<: *project
      network_ipams:
      - *network_ipam
      application_policy_set_refs:
      - *application_policy_set_ref

- name: get project without childred
  request:
    path: /project/test_project_uuid?exclude_children=true
    method: GET
    expected: [200]
  expect:
    project:
      <<: *project
      network_ipams: null

- name: get project without back refs
  request:
    path: /project/test_project_uuid?exclude_back_refs=true
    method: GET
    expected: [200]
  expect:
    project:
      <<: *project
      application_policy_set_refs: null

- name: delete network ipam
  request:
    path: /network-ipam/test_network_ipam_uuid
    method: DELETE
    expected: [200]

- name: delete project
  request:
    path: /project/test_project_uuid
    method: DELETE
    expected: [200]
